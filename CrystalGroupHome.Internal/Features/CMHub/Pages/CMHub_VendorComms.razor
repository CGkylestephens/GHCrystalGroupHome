@attribute [Route(NavHelpers.CMHub_VendorCommsMainPage)]
@attribute [Route(NavHelpers.CMHub_VendorCommsTrackerDetails)]
@attribute [Route(NavHelpers.CMHub_VendorCommsTrackerDetailsWithPartNum)]
@attribute [Authorize(Policy = AuthorizationPolicies.CMHubVendorCommsEdit)]
@using CrystalGroupHome.Internal.Authorization
@using CrystalGroupHome.Internal.Features.CMHub.VendorComms.Components
@using CrystalGroupHome.SharedRCL.Helpers
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Authorization
@inherits CMHub_VendorCommsBase
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Vendor Comms</PageTitle>

<Div Style="display: flex; margin-bottom: 0.5rem;">
    <h1>Vendor Comms</h1>
    <AuthorizeView Policy="@AuthorizationPolicies.CMHubAdmin" Context="adminAuth">
        <Authorized>
            <div class="role-tag">ADMIN</div>
        </Authorized>
        <NotAuthorized>
            <AuthorizeView Policy="@AuthorizationPolicies.CMHubVendorCommsEdit" Context="vendorCommsAuth">
                <Authorized>
                    <div class="role-tag">EDITOR</div>
                </Authorized>
            </AuthorizeView>
        </NotAuthorized>
    </AuthorizeView>
    <InfoHoverIcon Style="margin-left: 0.5rem; margin-bottom: 0.75rem;"
                    HoverText="@($"Members of \"{CMHubBase.CMHubAdminRole}\" are granted ADMIN permissions here. Members of \"{CMHubBase.VendorCommsAdminRole}\" are granted EDITOR permissions here.")" />

    <div style="flex-grow: 1;"></div>
    @if (CurrentView == "TrackerDetails")
    {
        <Button Color="Color.Secondary" Clicked="NavigateToTrackerGrid">
            <span class="@($"{NavHelpers.BackCircleIcon} me-2")" aria-hidden="true"></span> Back to All Vendor Communication Trackers
        </Button>
    }
</Div>
<Div>
    <CascadingValue Value="this">
        @if (CurrentView == "TrackerGrid")
        {
            <CMHub_VendorCommsTrackerGrid />
        }
        else if (CurrentView == "TrackerDetails" && PartNum != null)
        {
            <CMHub_VendorCommsTrackerForm PartNum="@PartNum" />
        }
    </CascadingValue>
</Div>