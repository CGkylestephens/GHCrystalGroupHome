@attribute [Route(NavHelpers.CMHub_CustCommsMainPage)]
@attribute [Route(NavHelpers.CMHub_CustCommsTrackerDetails)]
@attribute [Route(NavHelpers.CMHub_CustCommsTrackerDetailsWithPartNum)]
@attribute [Route(NavHelpers.CMHub_CustCommsAddTracker)]
@attribute [Route(NavHelpers.CMHub_CustCommsAddTrackerWithPartNum)]
@attribute [Route(NavHelpers.CMHub_CustCommsTaskList)]
@attribute [Route(NavHelpers.CMHub_CustCommsTaskDetails)]
@attribute [Route(NavHelpers.CMHub_CustCommsTaskDetailsWithTaskId)]
@attribute [Authorize]
@using CrystalGroupHome.Internal.Authorization
@using CrystalGroupHome.Internal.Features.CMHub.CustComms.Components
@using CrystalGroupHome.SharedRCL.Helpers
@using Microsoft.AspNetCore.Authorization
@inherits CMHub_CustCommsBase

<PageTitle>Customer Comms</PageTitle>

<Div Style="display: flex; margin-bottom: 0.5rem;">
    <h1>Customer Comms</h1>
    <AuthorizeView Policy="@AuthorizationPolicies.CMHubAdmin" Context="adminAuth">
        <Authorized>
            <div class="role-tag">ADMIN</div>
        </Authorized>
        <NotAuthorized>
            <AuthorizeView Policy="@AuthorizationPolicies.CMHubCustCommsEdit" Context="editorAuth">
                <Authorized>
                    <div class="role-tag">EDITOR</div>
                </Authorized>
            </AuthorizeView>
        </NotAuthorized>
    </AuthorizeView>
    <InfoHoverIcon Style="margin-left: 0.5rem; margin-bottom: 0.75rem;"
                   HoverText="@($"Members of \"{CMHubBase.CMHubAdminRole}\" are granted ADMIN permissions here. Members of \"{CMHubBase.CustCommsAdminRole}\" and \"{CMHubBase.PurchasingRole}\" have EDITOR permissions for Trackers. Members of \"{CMHubBase.PurchasingRole}\" cannot edit Task Statuses.")" />

    <div style="flex-grow: 1;"></div>
    @if (CurrentView == "TrackerDetails" || CurrentView == "TrackerAdd")
    {
        <Button Color="Color.Secondary" Clicked="NavigateToTrackerGrid">
            <span class="@($"{NavHelpers.BackCircleIcon} me-2")" aria-hidden="true"></span> Back to All Part Change Trackers
        </Button>
    }
</Div>
<Div>
    @if (CurrentView == "TrackerGrid")
    {
        <CMHub_CustCommsTrackerGrid />
    }
    else if (CurrentView == "TrackerAdd")
    {
        <CMHub_CustCommsTrackerForm PartNum="@PartNum" IsEditMode="false" />
    }
    else if (CurrentView == "TrackerDetails" && PartNum != null)
    {
        <CMHub_CustCommsTrackerForm PartNum="@PartNum" Statuses="@Statuses" IsEditMode="true" />
    }
    else if (CurrentView == "TaskGrid")
    {
        <CMHub_CustCommsTaskGrid />
    }
    else if (CurrentView == "TaskDetails" && TaskId != null)
    {
        <CMHub_CustCommsTaskForm TaskId="@TaskId" Statuses="@Statuses"/>
    }
</Div>